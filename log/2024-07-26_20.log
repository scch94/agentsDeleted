[2024-07-26 20:04:54.817] [Gconfiguration] [] [info] [] ending to get the configuration
[2024-07-26 20:04:54.817] [Gconfiguration] [] [trace] [] this is the data that we have in the configuration {"log_level":"trace","log_name":"agentsDeleted_","database_connection_string":"postgres://xxepin:migracion@digicel-dev-flex.postgres.database.azure.com:5432/xxepin?sslmode=require","tenant":4,"ubication_agents_file":"../utils/agents.txt"}
[2024-07-26 20:04:55.672] [agentsdeleter] [databaseConnection] [info] [] connected to postgres database
[2024-07-26 20:04:55.672] [agentsdeleter] [fileReader] [info] [] starting to get the agents  ubication of the file is ../utils/agents.txt
[2024-07-26 20:04:55.675] [agentsdeleter] [main] [info] [] number of agents are 4
[2024-07-26 20:04:55.675] [agentsdeleter] [controller] [info] [] starting to create the script to delete agents_mobile
[2024-07-26 20:04:55.675] [agentsdeleter] [controller] [trace] [] starting to get agents_msisdn info
[2024-07-26 20:04:55.677] [agentsdeleter] [database] [trace] [] starting to get the msisdn por the agent with id :996008814317
[2024-07-26 20:04:55.677] [agentsdeleter] [database] [trace] [] this is the QUERY: SELECT AM.OID, A.OID, MSISDN, ACC.CREDIT FROM agent A INNER JOIN agent_mobile AM ON AM.AGENT_OID=A.OID INNER JOIN account ACC ON ACC.AGENT_OID = A.OID WHERE A.AGENT_ID=$1 AND A.TENANT_OID=$2 and the params: agentID=996008814317, and tenant_oid=4
[2024-07-26 20:04:56.419] [agentsdeleter] [database] [info] [] the query in the database tooks: 742.4954ms
[2024-07-26 20:04:56.419] [agentsdeleter] [controller] [trace] [] the agent with id 996008814317 has 1 moviles
[2024-07-26 20:04:56.419] [agentsdeleter] [database] [trace] [] starting to get the msisdn por the agent with id :996008814232 
[2024-07-26 20:04:56.420] [agentsdeleter] [database] [trace] [] this is the QUERY: SELECT AM.OID, A.OID, MSISDN, ACC.CREDIT FROM agent A INNER JOIN agent_mobile AM ON AM.AGENT_OID=A.OID INNER JOIN account ACC ON ACC.AGENT_OID = A.OID WHERE A.AGENT_ID=$1 AND A.TENANT_OID=$2 and the params: agentID=996008814232 , and tenant_oid=4
[2024-07-26 20:04:57.149] [agentsdeleter] [database] [info] [] the query in the database tooks: 729.6718ms
[2024-07-26 20:04:57.149] [agentsdeleter] [controller] [trace] [] the agent with id 996008814232  has 1 moviles
[2024-07-26 20:04:57.150] [agentsdeleter] [database] [trace] [] starting to get the msisdn por the agent with id :0
[2024-07-26 20:04:57.150] [agentsdeleter] [database] [trace] [] this is the QUERY: SELECT AM.OID, A.OID, MSISDN, ACC.CREDIT FROM agent A INNER JOIN agent_mobile AM ON AM.AGENT_OID=A.OID INNER JOIN account ACC ON ACC.AGENT_OID = A.OID WHERE A.AGENT_ID=$1 AND A.TENANT_OID=$2 and the params: agentID=0, and tenant_oid=4
[2024-07-26 20:04:57.903] [agentsdeleter] [database] [info] [] the query in the database tooks: 753.2374ms
[2024-07-26 20:04:57.903] [agentsdeleter] [controller] [trace] [] the agent with id 0 has 0 moviles
[2024-07-26 20:04:57.904] [agentsdeleter] [database] [trace] [] starting to get the msisdn por the agent with id :996008814335
[2024-07-26 20:04:57.904] [agentsdeleter] [database] [trace] [] this is the QUERY: SELECT AM.OID, A.OID, MSISDN, ACC.CREDIT FROM agent A INNER JOIN agent_mobile AM ON AM.AGENT_OID=A.OID INNER JOIN account ACC ON ACC.AGENT_OID = A.OID WHERE A.AGENT_ID=$1 AND A.TENANT_OID=$2 and the params: agentID=996008814335, and tenant_oid=4
[2024-07-26 20:04:58.651] [agentsdeleter] [database] [info] [] the query in the database tooks: 747.6276ms
[2024-07-26 20:04:58.652] [agentsdeleter] [controller] [trace] [] the agent with id 996008814335 has 1 moviles
[2024-07-26 20:04:58.652] [agentsdeleter] [queryBuilder] [info] [] starting to create a query to delete data to the table agent_mobile_pin
[2024-07-26 20:04:58.653] [agentsdeleter] [fileWriter] [info] [] starting to write in the file ../scripts/agent_mobile_scripts.txt
[2024-07-26 20:04:58.654] [agentsdeleter] [fileWriter] [trace] [] end to wrtite in a file: 
[2024-07-26 20:04:58.655] [agentsdeleter] [controller] [info] [] query to delete agent mobile pin was created and writed
[2024-07-26 20:04:58.655] [agentsdeleter] [queryBuilder] [info] [] starting to create a query to delete data to the table agent_mobile
[2024-07-26 20:04:58.655] [agentsdeleter] [fileWriter] [info] [] starting to write in the file ../scripts/agent_mobile_scripts.txt
[2024-07-26 20:04:58.656] [agentsdeleter] [fileWriter] [trace] [] end to wrtite in a file: 
[2024-07-26 20:04:58.657] [agentsdeleter] [controller] [info] [] query to delete agent mobile was created and writed
[2024-07-26 20:04:58.657] [agentsdeleter] [controller] [info] [] starting to create the script to delete Users vinculated to the agents in the list
[2024-07-26 20:04:58.657] [agentsdeleter] [controller] [trace] [] starting to get users
[2024-07-26 20:04:58.658] [agentsdeleter] [database] [trace] [] starting to get the Users por the agent with oid :113272
[2024-07-26 20:04:58.658] [agentsdeleter] [database] [trace] [] this is the QUERY: SELECT ua.oid, ua.user_id, cu.client_oid FROM user_adm ua JOIN client_user cu ON ua.oid = cu.user_oid WHERE cu.client_oid = $1 AND cu.tenant_oid=$2 and the params: agentID=113272, and tenant_oid=%!s(int=4)
[2024-07-26 20:04:59.389] [agentsdeleter] [database] [info] [] the query in the database tooks: 731.7113ms
[2024-07-26 20:04:59.390] [agentsdeleter] [database] [trace] [] starting to check if the user testing_ky3 can be deleted :%!v(MISSING)
[2024-07-26 20:04:59.390] [agentsdeleter] [database] [trace] [] this is the QUERY: SELECT * FROM user_Adm WHERE (user_parent_oid = $1 OR view_user_parent_oid = $2 ) and tenant_oid= $3 limit 1 and the params: agentID=30520, and tenant_oid=30520%!(EXTRA int=4)
[2024-07-26 20:05:00.102] [agentsdeleter] [database] [info] [] User testing_ky3 is not a parent and can be deleted
[2024-07-26 20:05:00.102] [agentsdeleter] [database] [info] [] the query in the database tooks: 712.142ms
[2024-07-26 20:05:00.102] [agentsdeleter] [database] [trace] [] starting to check if the user testin231321 can be deleted :%!v(MISSING)
[2024-07-26 20:05:00.102] [agentsdeleter] [database] [trace] [] this is the QUERY: SELECT * FROM user_Adm WHERE (user_parent_oid = $1 OR view_user_parent_oid = $2 ) and tenant_oid= $3 limit 1 and the params: agentID=30521, and tenant_oid=30521%!(EXTRA int=4)
[2024-07-26 20:05:00.857] [agentsdeleter] [database] [info] [] User testin231321 is not a parent and can be deleted
[2024-07-26 20:05:00.857] [agentsdeleter] [database] [info] [] the query in the database tooks: 754.0641ms
[2024-07-26 20:05:00.857] [agentsdeleter] [database] [trace] [] starting to check if the user testing-subdis can be deleted :%!v(MISSING)
[2024-07-26 20:05:00.857] [agentsdeleter] [database] [trace] [] this is the QUERY: SELECT * FROM user_Adm WHERE (user_parent_oid = $1 OR view_user_parent_oid = $2 ) and tenant_oid= $3 limit 1 and the params: agentID=30360, and tenant_oid=30360%!(EXTRA int=4)
[2024-07-26 20:05:01.611] [agentsdeleter] [database] [info] [] User testing-subdis is not a parent and can be deleted
[2024-07-26 20:05:01.611] [agentsdeleter] [database] [info] [] the query in the database tooks: 753.8508ms
[2024-07-26 20:05:01.611] [agentsdeleter] [database] [trace] [] starting to check if the user subdistributor_KY can be deleted :%!v(MISSING)
[2024-07-26 20:05:01.611] [agentsdeleter] [database] [trace] [] this is the QUERY: SELECT * FROM user_Adm WHERE (user_parent_oid = $1 OR view_user_parent_oid = $2 ) and tenant_oid= $3 limit 1 and the params: agentID=30380, and tenant_oid=30380%!(EXTRA int=4)
[2024-07-26 20:05:02.326] [agentsdeleter] [database] [info] [] User subdistributor_KY is a parent and cannot be deleted
[2024-07-26 20:05:02.326] [agentsdeleter] [database] [info] [] the query in the database tooks: 714.6368ms
[2024-07-26 20:05:02.327] [agentsdeleter] [controller] [trace] [] the agent with id 996008814317 has 4 users
[2024-07-26 20:05:02.327] [agentsdeleter] [database] [trace] [] starting to get the Users por the agent with oid :4788
[2024-07-26 20:05:02.327] [agentsdeleter] [database] [trace] [] this is the QUERY: SELECT ua.oid, ua.user_id, cu.client_oid FROM user_adm ua JOIN client_user cu ON ua.oid = cu.user_oid WHERE cu.client_oid = $1 AND cu.tenant_oid=$2 and the params: agentID=4788, and tenant_oid=%!s(int=4)
[2024-07-26 20:05:03.083] [agentsdeleter] [database] [info] [] the query in the database tooks: 756.9025ms
[2024-07-26 20:05:03.084] [agentsdeleter] [controller] [trace] [] the agent with id 996008814232  has 0 users
[2024-07-26 20:05:03.084] [agentsdeleter] [database] [trace] [] starting to get the Users por the agent with oid :
[2024-07-26 20:05:03.084] [agentsdeleter] [database] [trace] [] this is the QUERY: SELECT ua.oid, ua.user_id, cu.client_oid FROM user_adm ua JOIN client_user cu ON ua.oid = cu.user_oid WHERE cu.client_oid = $1 AND cu.tenant_oid=$2 and the params: agentID=, and tenant_oid=%!s(int=4)
[2024-07-26 20:05:03.809] [agentsdeleter] [database] [error] [] query error pq: invalid input syntax for type bigint: ""
[2024-07-26 20:05:03.809] [agentsdeleter] [controller] [error] [] error in getUsers: pq: invalid input syntax for type bigint: ""
[2024-07-26 20:05:03.810] [agentsdeleter] [controller] [trace] [] the agent with id 0 has 0 users
[2024-07-26 20:05:03.810] [agentsdeleter] [database] [trace] [] starting to get the Users por the agent with oid :113771
[2024-07-26 20:05:03.810] [agentsdeleter] [database] [trace] [] this is the QUERY: SELECT ua.oid, ua.user_id, cu.client_oid FROM user_adm ua JOIN client_user cu ON ua.oid = cu.user_oid WHERE cu.client_oid = $1 AND cu.tenant_oid=$2 and the params: agentID=113771, and tenant_oid=%!s(int=4)
[2024-07-26 20:05:04.539] [agentsdeleter] [database] [info] [] the query in the database tooks: 729.3841ms
[2024-07-26 20:05:04.540] [agentsdeleter] [controller] [trace] [] the agent with id 996008814335 has 0 users
[2024-07-26 20:05:04.541] [agentsdeleter] [controller] [info] [] usuarios : [{30520 testing_ky3 113272 {true User testing_ky3 is not a parent and can be deleted}} {30521 testin231321 113272 {true User testin231321 is not a parent and can be deleted}} {30360 testing-subdis 113272 {true User testing-subdis is not a parent and can be deleted}} {30380 subdistributor_KY 113272 {false User subdistributor_KY is a parent and cannot be deleted}}] agentes &[{996008814317 113272 9999402.460000 {false agent whit id 996008814317, can not deleted reasons : User subdistributor_KY is a parent and cannot be deleted.}} {996008814232  4788 0.000000 {true }} {0   {true }} {996008814335 113771 0.000000 {true }}]
[2024-07-26 20:05:04.542] [agentsdeleter] [queryBuilder] [info] [] starting to create a query to delete data to the table old_password
[2024-07-26 20:05:04.542] [agentsdeleter] [fileWriter] [info] [] starting to write in the file ../scripts/users.txt
[2024-07-26 20:05:04.543] [agentsdeleter] [fileWriter] [trace] [] end to wrtite in a file: 
[2024-07-26 20:05:04.543] [agentsdeleter] [controller] [info] [] query to delete users_old_password was created and writed
[2024-07-26 20:05:04.544] [agentsdeleter] [queryBuilder] [info] [] starting to create a query to delete data to the table client_user
[2024-07-26 20:05:04.544] [agentsdeleter] [fileWriter] [info] [] starting to write in the file ../scripts/users.txt
[2024-07-26 20:05:04.545] [agentsdeleter] [fileWriter] [trace] [] end to wrtite in a file: 
[2024-07-26 20:05:04.546] [agentsdeleter] [controller] [info] [] query to delete ClientUser was created and writed
[2024-07-26 20:05:04.546] [agentsdeleter] [queryBuilder] [info] [] starting to create a query to delete data to the table user_adm
[2024-07-26 20:05:04.546] [agentsdeleter] [fileWriter] [info] [] starting to write in the file ../scripts/users.txt
[2024-07-26 20:05:04.547] [agentsdeleter] [fileWriter] [trace] [] end to wrtite in a file: 
[2024-07-26 20:05:04.548] [agentsdeleter] [controller] [info] [] query to delete user_adm was created and writed
[2024-07-26 20:05:04.548] [agentsdeleter] [controller] [info] [] starting to create the script to delete agents 
[2024-07-26 20:05:04.548] [agentsdeleter] [controller] [trace] [] checking if the agents have a credit different than 0
[2024-07-26 20:05:04.548] [agentsdeleter] [controller] [info] [] check credit accounts finish
[2024-07-26 20:05:04.548] [agentsdeleter] [controller] [trace] [] checking if the agents are parents
[2024-07-26 20:05:04.548] [agentsdeleter] [database] [trace] [] starting to check if the Agent whit id 996008814317 is a parent 
[2024-07-26 20:05:04.548] [agentsdeleter] [database] [trace] [] this is the QUERY: SELECT * FROM agent WHERE parent_oid= $1 AND tenant_oid= $2 limit 1 and the params: agentID=113272, and tenant_oid=%!s(int=4)
[2024-07-26 20:05:05.301] [agentsdeleter] [database] [info] [] Agent 113272 is a parent and cannot be deleted
[2024-07-26 20:05:05.301] [agentsdeleter] [database] [info] [] the query in the database tooks: 752.9635ms
[2024-07-26 20:05:05.301] [agentsdeleter] [database] [trace] [] starting to check if the Agent whit id 996008814232  is a parent 
[2024-07-26 20:05:05.301] [agentsdeleter] [database] [trace] [] this is the QUERY: SELECT * FROM agent WHERE parent_oid= $1 AND tenant_oid= $2 limit 1 and the params: agentID=4788, and tenant_oid=%!s(int=4)
[2024-07-26 20:05:06.181] [agentsdeleter] [database] [info] [] Agent 4788 is not a parent and can be deleted
[2024-07-26 20:05:06.181] [agentsdeleter] [database] [info] [] the query in the database tooks: 879.5661ms
[2024-07-26 20:05:06.181] [agentsdeleter] [database] [trace] [] starting to check if the Agent whit id 0 is a parent 
[2024-07-26 20:05:06.181] [agentsdeleter] [database] [trace] [] this is the QUERY: SELECT * FROM agent WHERE parent_oid= $1 AND tenant_oid= $2 limit 1 and the params: agentID=, and tenant_oid=%!s(int=4)
[2024-07-26 20:05:06.924] [agentsdeleter] [database] [error] [] query error pq: invalid input syntax for type bigint: ""
[2024-07-26 20:05:06.924] [agentsdeleter] [controller] [error] [] error in the database function IsAgentParent err: pq: invalid input syntax for type bigint: ""
[2024-07-26 20:05:06.924] [agentsdeleter] [controller] [error] [] error in the function isAgentsParent() err: pq: invalid input syntax for type bigint: ""
[2024-07-26 20:05:06.925] [agentsdeleter] [main] [error] [] error creating the script to delete the users of the agents: pq: invalid input syntax for type bigint: ""
